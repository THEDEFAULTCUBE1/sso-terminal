<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>S.S.O. Terminal — Act I (Classified)</title>
<style>
:root{
  --bg:#000; --text:#8ef08e; --accent:#62d662; --muted:#2f6f2f;
  --warn:#ffd166; --err:#ff6b6b; --mono:ui-monospace,SFMono-Regular,Menlo,Monaco,"Roboto Mono","Courier New",monospace;
}
html,body{height:100%;margin:0;background:#000;}
body{
  font-family:var(--mono); color:var(--text); display:flex; align-items:center; justify-content:center;
  padding:22px; background: radial-gradient(ellipse at top left, rgba(0,30,0,0.08) 0%, rgba(0,0,0,1) 65%);
}
.frame{
  width:960px; max-width:96vw; height:760px; background:linear-gradient(180deg, rgba(0,0,0,0.96), rgba(0,0,0,0.995));
  border-radius:8px; box-shadow:0 18px 80px rgba(0,0,0,0.95), inset 0 0 48px rgba(0,255,0,0.02);
  border:2px solid rgba(30,255,30,0.04); position:relative; overflow:hidden;
}
.status{position:absolute;left:0;right:0;top:0;padding:8px 14px;border-bottom:1px solid rgba(255,255,255,0.02);color:var(--muted);font-size:13px}
.display{padding:38px 18px 18px 18px;height:100%;overflow:auto;box-sizing:border-box;position:relative}
.line{white-space:pre-wrap;line-height:1.35;font-size:15.4px;color:var(--text);margin:0 0 6px 0}
.muted{color:var(--muted)} .accent{color:var(--accent)} .err{color:var(--err)} .warn{color:var(--warn)}
.box{border:1px dashed rgba(100,255,100,0.05);padding:10px;border-radius:4px;background:transparent}
.cmdline{margin-top:8px} .prompt{display:inline-block}
.input{outline:none;border:none;background:transparent;color:var(--text);font-family:var(--mono);font-size:15.4px}
.cursor{display:inline-block;width:10px;height:20px;background:var(--text);margin-left:6px;vertical-align:bottom;animation:blink 1s steps(2,end) infinite}
@keyframes blink{50%{opacity:0}}
pre{font-family:var(--mono);font-size:15px;white-space:pre-wrap;word-break:break-word}
.loading-wrp{display:block;width:74%;min-width:380px;margin-top:6px;margin-bottom:6px}
.loading-label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
.loading-track{width:100%;height:12px;background:rgba(0,255,0,0.03);border-radius:6px;border:1px solid rgba(0,255,0,0.02);overflow:hidden}
.loading-bar{height:100%;width:0%;background:linear-gradient(90deg,var(--accent), #9ef09a);box-shadow:inset 0 -6px 12px rgba(0,0,0,0.2)}
.loading-percent{display:inline-block;margin-left:8px;color:var(--muted);font-size:13px}
.crt{position:absolute;left:0;top:0;right:0;bottom:0;pointer-events:none;background-image: linear-gradient(rgba(0,0,0,0.0) 50%, rgba(0,0,0,0.025) 51%);background-size: 100% 4px;mix-blend-mode:overlay;}
.glow{position:absolute;left:-10%;top:-10%;width:120%;height:120%;pointer-events:none;background:radial-gradient(circle at 20% 10%, rgba(0,255,50,0.03), transparent 15%);}
.flicker{animation:flicker 0.14s infinite} @keyframes flicker{0%,100%{opacity:1}50%{opacity:0.22}}
.ascii{font-family:var(--mono);font-size:11px;letter-spacing:1px;color:var(--muted)}
.small{font-size:12px;color:rgba(142,240,142,0.6)} .hidden{display:none}
.display::-webkit-scrollbar{width:12px} .display::-webkit-scrollbar-thumb{background:rgba(0,255,0,0.06);border-radius:6px}
.footerNote{position:absolute;right:12px;bottom:8px;font-size:11px;color:var(--muted)}
</style>
</head>
<body>
  <div class="frame" role="region" aria-label="S.S.O. Terminal">
    <div class="status small">S.S.O. SYSTEM — SECTOR 07 ACCESS PANEL</div>
    <div id="display" class="display" tabindex="0" aria-live="polite"></div>
    <div class="crt"></div>
    <div class="glow"></div>
    <div class="footerNote small">Type HELP for commands</div>
  </div>

<script>
/* ================= CONFIG =================
   Password: DIVISIONGAMMA
   Files required in same folder:
     - background.mp3
     - OhGod.mp3
     - end.png
   ================================================== */
const PASSWORD = 'DIVISIONGAMMA';
const display = document.getElementById('display');

/* ====== small audio engine (8-bit beeps + noise) ====== */
let audioCtx = null;
function ensureAudio(){ if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); }
function beep(f=880,t=0.05,type='sine',vol=0.06){ ensureAudio(); const o = audioCtx.createOscillator(); const g = audioCtx.createGain(); o.type=type; o.frequency.value=f; g.gain.value=vol; o.connect(g); g.connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime + t); }
function noiseBurst(duration=0.12,vol=0.04){ ensureAudio(); const sr = audioCtx.sampleRate; const buffer = audioCtx.createBuffer(1, sr * duration, sr); const data = buffer.getChannelData(0); for(let i=0;i<data.length;i++) data[i] = (Math.random()*2-1) * (1 - i/data.length); const src = audioCtx.createBufferSource(); src.buffer = buffer; const g = audioCtx.createGain(); g.gain.value = vol; src.connect(g); g.connect(audioCtx.destination); src.start(); }

/* ====== Obfuscated secrets: stored as char-code arrays to hide from casual inspection ======
   If you need to edit: replace the numbers with the char codes of your new text.
   Use an online tool or local script to convert text -> char codes (UTF-8).
*/
const SECRETS = {
  AUTHORIZED: [48,51,32,77,65,82,67,72,32,50,48,50,52,46,10,79,80,69,82,65,84,73,79,78,58,32,91,32,82,69,68,65,67,84,69,68,32,93,10,10,60,60,32,70,65,73,76,69,68,32,84,79,32,67,79,78,78,69,67,84,32,84,79,32,71,82,79,85,80,32,65,46,32,62,62,10,60,60,32,70,65,73,76,69,68,32,84,79,32,67,79,78,78,69,67,84,32,84,79,32,71,82,79,85,80,32,66,46,32,62,62,10,60,60,32,70,65,73,76,69,68,32,84,79,32,67,79,78,78,69,67,84,32,84,79,32,71,82,79,85,80,32,67,46,32,62,62,10,10,65,84,84,69,77,80,84,73,78,71,32,85,78,73,86,69,82,83,65,76,32,67,79,78,84,65,67,84,46,46,46,10,70,65,73,76,85,82,69,46,10,65,84,84,69,77,80,84,73,78,71,32,85,78,73,86,69,82,83,65,76,32,67,79,78,84,65,67,84,46,46,46,10,70,65,73,76,85,82,69,46,10,78,79,32,76,79,67,65,84,73,79,78,32,70,79,82,32,85,78,73,86,69,82,83,65,76,32,67,79,78,84,65,67,84,46,10,10,65,84,84,69,77,80,84,32,84,79,32,84,82,65,67,69,32,85,83,73,78,71,32,84,72,69,32,84,69,82,77,73,78,65,76,46],
  TRACE_APPEND: [32,65,84,84,69,77,80,84,73,78,71,32,84,79,32,84,82,65,67,69,32,71,82,79,85,80,32,65,46,10,70,65,73,76,85,82,69,46,10,65,84,84,69,77,80,84,73,78,71,32,84,79,32,84,82,65,67,69,32,71,82,79,85,80,32,66,46,10,70,65,73,76,85,82,69,46,10,65,84,84,69,77,80,84,73,78,71,32,84,79,32,84,82,65,67,69,32,71,82,79,85,80,32,67,46,10,83,85,67,67,69,83,83,46,10,80,76,69,65,83,69,32,65,67,67,69,83,83,32,60,35,65,67,69,32,35,35,79,85,80,32,67,62],
  TRACE_GROUP_C: [65,84,84,69,77,80,84,73,78,71,32,84,79,32,84,82,65,67,69,46,10,83,85,67,67,69,83,83,46,10,10,71,82,79,85,80,32,67,32,76,79,67,65,84,73,79,78,58,32,84,79,87,69,82,46,10,71,82,79,85,80,32,67,32,83,84,65,84,85,83,58,32,35,35,35,35,32,72,69,76,80,85,83,35,35,35,32,72,69,76,80,35,35,10,69,82,82,79,82,46,10,71,82,79,85,80,32,67,32,83,84,65,84,85,83,58,32,84,87,79,32,77,69,77,66,69,82,83,32,84,69,82,77,73,78,65,84,69,68,46,32,79,78,69,32,77,69,77,66,69,82,32,72,69,65,86,73,76,89,32,87,79,85,78,68,69,68,46,10,80,76,69,65,83,69,32,82,85,78,32,84,72,69,32,34,32,67,79,78,78,69,67,84,32,34,32,67,79,77,77,65,78,68,32,84,79,32,69,83,84,65,66,76,73,83,72,32,65,32,72,65,78,68,83,72,65,75,69,32,87,73,84,72,32,71,82,79,85,80,32,67,46],
  CONNECT_SUCCESS: [67,79,78,78,69,67,84,73,79,78,32,83,85,67,67,69,83,70,85,76,46,32,67,79,78,78,69,67,84,73,78,71,32,89,79,85,32,84,79,32,71,82,79,85,80,32,67,46,10,67,79,78,78,69,67,84,73,79,78,32,83,85,67,67,69,83,83,46,32,89,79,85,32,65,82,69,32,78,79,87,32,83,80,69,65,75,73,78,71,32,84,79,58,32,77,73,75,69,32,35,35,35,35,35,35,46],
  OHGOD: [83,85,66,74,69,67,84,58,32,35,35,35,35,10,84,69,83,84,69,68,32,86,73,65,76,58,32,35,35,35,35,35,10,82,69,83,85,76,84,83,58,32,83,85,66,74,69,67,84,32,72,65,83,32,83,84,65,82,84,69,68,32,86,79,77,73,84,73,78,71,32,80,85,82,80,76,69,32,76,73,81,85,73,68,32,65,70,84,69,82,32,84,65,75,73,78,71,32,84,72,69,32,86,73,65,76,46,32,65,70,84,69,82,32,65,32,83,72,79,82,84,32,77,79,77,69,78,84,32,84,72,69,89,32,68,73,69,68,32,84,79,32,85,78,75,78,79,87,78,32,82,69,65,83,79,78,83,46,32,65,32,83,79,82,84,32,79,70,32,71,72,79,83,84,76,89,32,72,85,77,65,78,79,73,68,32,67,65,77,69,32,79,85,84,32,79,70,32,84,72,69,32,71,82,79,85,78,68,44,32,65,80,80,82,79,65,67,72,73,78,71,32,84,72,69,32,67,79,82,80,83,69,32,66,69,70,79,82,69,32,86,65,78,73,83,72,73,78,71,32,65,76,79,78,71,32,87,73,84,72,32,84,72,69,32,67,79,82,80,83,69,32,73,78,32,65,32,66,76,65,67,75,32,77,73,83,84,46,10,10,65,70,84,69,82,77,65,84,72,58,32,65,32,72,79,79,68,69,68,32,72,85,77,65,78,79,73,68,32,70,73,71,85,82,69,32,65,80,80,69,65,82,69,68,32,78,69,65,82,32,84,83,45,35,35,32,87,73,84,72,32,65,32,76,79,78,71,32,83,87,79,82,68,44,32,73,77,77,85,78,69,32,84,79,32,66,85,76,76,69,84,83,32,84,72,65,84,32,77,65,78,65,71,69,68,32,84,79,32,83,76,65,85,71,72,84,69,82,32,84,72,73,82,84,89,32,84,72,82,69,69,32,83,69,67,85,82,73,84,89,32,71,85,65,82,68,83,44,32,66,69,70,79,82,69,32,66,69,73,78,71,32,83,84,65,66,66,69,68,32,84,79,32,68,69,65,84,72,32,65,78,68,32,86,65,78,73,83,72,73,78,71,32,73,78,84,79,32,65,32,66,76,65,67,75,32,77,73,83,84,46,10,10,65,83,83,85,77,80,84,73,79,78,83,58,32,84,72,69,32,72,79,79,68,69,68,32,72,85,77,65,78,79,73,68,32,70,73,71,85,82,69,32,73,83,32,66,85,76,76,69,80,82,79,79,70,32,66,85,84,32,67,79,77,80,76,69,84,76,89,32,86,85,76,78,69,82,65,66,76,69,32,84,79,32,83,72,65,82,80,44,32,66,76,85,78,84,32,79,66,74,69,67,84,83,46,10,78,69,87,32,68,69,83,73,71,65,84,73,79,78,58,32,70,35,35,76,35,78,46],
  FALLEN: [69,78,67,82,89,80,84,69,68,32,76,73,78,75,58,32,104,116,116,112,115,58,47,47,121,111,117,116,117,46,98,101,47,119,108,114,53,71,112,102,83,113,65,107,10,40,82,101,112,108,97,99,101,32,119,105,116,104,32,102,105,110,97,108,32,101,110,99,114,121,112,116,101,100,32,108,105,110,107,32,105,102,32,110,101,101,100,101,100,41],
  AUDIO_TRANSCRIPT: [65,85,68,73,79,32,84,65,80,69,32,49,55,32,83,69,80,84,69,77,66,69,82,32,50,48,50,52,32,84,82,65,78,83,67,82,73,80,84,46,10,65,67,67,69,83,83,32,76,69,86,69,76,32,73,78,83,85,82,71,69,78,67,89,32,80,82,73,79,82,73,84,89,32,67,65,82,68,32,35,51,32,82,69,81,85,73,82,69,68,46,10,10,34,32,83,105,103,104,44,32,119,104,97,116,32,100,111,32,119,101,32,100,111,32,110,111,119,63,32,34,10,34,32,73,32,102,105,114,101,100,32,52,48,32,109,101,109,98,101,114,115,32,111,110,32,109,121,32,115,101,99,111,110,100,32,100,97,121,46,32,78,111,32,119,111,110,100,101,114,32,121,111,117,32,110,101,101,100,101,100,32,116,111,32,99,114,101,97,116,101,32,68,73,86,73,83,73,79,78,71,65,77,77,65,46,32,34,10,34,32,77,101,109,98,101,114,115,32,97,114,101,32,97,108,114,101,97,100,121,32,97,110,103,114,121,32,97,115,115,117,109,105,110,103,32,116,104,97,116,32,68,105,118,105,115,105,111,110,32,103,97,109,109,97,32,105,115,32,106,117,115,116,32,115,101,99,117,114,105,116,121,32,112,101,114,115,111,110,110,101,108,32,109,97,100,101,32,115,99,97,114,101,114,46,32,34,10,34,32,87,101,108,108,32,116,104,101,110,32,116,104,101,121,32,66,69,84,84,69,82,32,116,97,107,101,32,116,104,105,115,32,115,101,114,105,111,117,115,46,32,34,10,34,32,72,111,119,32,109,97,110,121,32,100,105,100,32,121,111,117,32,107,105,108,108,63,32,34,10,34,32,70,105,102,116,121,32,102,111,117,114,32,40,53,52,41,46,32,34,10,34,32,65,110,100,63,32,34,10,34,32,84,72,69,89,39,82,69,75,69,69,80,73,78,71,79,78,69,65,76,73,86,69,32,46,34,10,34,32,87,104,111,32,105,115,32,105,116,63,32,34,10,60,60,32,69,82,82,79,82,32,89,79,85,32,68,79,32,78,79,84,32,72,65,86,69,32,84,72,69,32,82,69,81,85,73,82,69,68,32,65,67,67,69,83,83,46,32,62,62,10,60,60,32,65,85,84,72,79,82,73,84,73,69,83,32,72,65,86,69,32,66,69,69,78,32,65,76,69,82,84,69,68,46,32,62,62],
  THEYREKEEP: [68,73,86,73,83,73,79,78,32,71,65,77,77,65,32,70,65,67,73,76,73,84,89,32,34,84,83,45,56,52,34,32,82,65,73,68,32,76,79,71,83,46,10,10,69,78,84,69,82,69,68,32,65,84,58,32,48,53,48,48,32,104,111,117,114,115,32,40,32,108,111,99,97,108,32,41,10,76,69,70,84,32,65,84,58,32,50,51,48,48,32,72,79,85,82,83,32,40,32,108,111,99,97,108,32,41,10,10,70,79,85,78,68,32,73,78,70,79,82,77,65,84,73,79,78,58,10,45,32,79,110,101,32,104,117,110,100,114,101,100,32,116,104,105,114,116,121,32,115,101,118,101,110,32,40,49,51,55,41,32,100,101,97,100,32,98,111,100,105,101,115,10,45,32,84,119,111,32,40,50,41,32,107,101,121,99,97,114,100,115,32,119,105,116,104,32,98,108,111,111,100,32,115,116,97,105,110,115,46,10,45,32,84,119,111,32,40,50,41,32,66,108,111,99,107,101,100,32,111,102,102,32,99,104,101,99,107,112,111,105,110,116,115,32,105,110,115,105,100,101,46,10,45,32,79,110,101,32,40,49,41,32,78,111,110,32,105,100,101,110,116,105,102,105,97,98,108,101,32,111,98,106,101,99,116,46,10,10,75,101,121,99,97,114,100,115,32,104,97,100,32,116,104,101,32,110,97,109,101,115,32,111,102,58,32,71,85,35,35,35,32,35,35,35,35,35,35,35,32,97,110,100,32,70,69,78,73,35,32,35,35,35,35,35,35,35,35,35,35,35],
  ACCESS_FENIX: [83,46,83,46,79,46,32,67,79,76,79,78,69,76,32,70,69,78,73,88,46,10,68,73,86,73,83,73,79,78,32,71,65,77,77,65,32,80,82,73,79,82,73,84,89,32,67,65,82,68,32,48,46,10,73,78,83,85,82,71,69,78,67,89,32,80,82,73,79,82,73,84,89,32,67,65,82,68,32,48,46,10,83,83,79,32,80,82,73,79,82,73,84,89,32,67,65,82,68,32,52,46,10,10,34,70,111,114,109,101,114,32,35,35,35,35,35,32,83,101,99,111,110,100,97,114,121,32,108,101,97,100,101,114,44,32,106,111,105,110,101,100,32,116,104,101,32,83,46,83,46,32,97,102,116,101,114,32,116,104,101,32,105,110,99,105,100,101,110,116,115,32,111,102,32,71,49,51,45,48,50,44,32,101,120,112,101,114,105,101,110,99,101,32,105,110,32,119,101,97,112,111,110,114,121,32,97,110,100,32,116,97,99,116,105,99,97,108,32,97,100,118,97,110,99,101,109,101,110,116,115,46,34],
  G13: [71,49,51,45,48,50,32,119,97,115,32,116,104,101,32,100,101,115,105,103,110,97,116,101,100,32,110,117,109,98,101,114,32,102,111,114,32,116,104,101,32,117,110,107,110,111,119,110,32,115,117,98,115,116,97,110,99,101,32,102,111,117,110,100,32,110,101,97,114,32,84,83,45,35,35,44,32,73,116,32,119,97,115,32,116,101,115,116,101,100,32,117,112,111,110,32,97,32,104,117,109,97,110,32,97,110,100,32,97,102,116,101,114,32,84,104,114,101,101,32,40,51,41,32,104,111,117,114,115,32,111,102,32,119,97,105,116,105,110,103,44,32,116,104,101,32,115,117,98,106,101,99,116,32,109,117,116,97,116,101,100,32,105,110,116,111,32,97,32,104,111,114,114,105,102,121,105,110,103,32,109,97,115,115,32,111,102,32,102,108,101,115,104,46,32,73,116,32,109,97,110,97,103,101,100,32,116,111,32,98,114,101,97,99,104,32,105,116,115,32,97,114,101,97,32,97,110,100,32,114,101,97,99,104,32,116,104,101,32,35,35,35,35,35,35,35,32,122,111,110,101,32,98,101,102,111,114,101,32,103,101,116,116,105,110,103,32,115,104,111,116,32,100,111,119,110,32,98,121,32,35,35,35,35,35,35,32,109,101,109,98,101,114,115,46,32,73,116,32,115,117,114,118,105,118,101,100,32,79,78,69,32,84,72,79,85,83,65,78,68,32,40,49,48,48,48,41,32,114,111,117,110,100,115,32,111,102,32,65,80,32,55,46,54,50,120,53,49,46,10,10,60,60,32,69,82,82,79,82,32,84,69,82,77,73,78,65,76,32,72,65,83,32,66,69,69,78,32,72,73,74,65,67,75,69,68,32,80,76,69,65,83,69,32,10,60,60,32,73,32,75,78,79,87,32,87,72,79,32,89,79,85,32,65,82,69,46,32,62,62,10,60,60,32,89,79,85,32,87,65,78,84,32,84,79,79,32,77,85,67,72,46,32,62,62,10,60,60,32,84,72,69,89,32,75,73,76,76,69,68,32,65,32,84,79,78,32,79,70,32,73,78,78,79,67,69,78,84,32,80,69,79,80,76,69,46,32,62,62,10,60,60,32,73,84,83,32,65,76,76,32,72,73,83,32,70,65,85,76,84,46,32,62,62,10,10,69,110,100,32,111,102,32,97,99,116,32,49,46]
};

/* reconstruct string from char-code array */
function fromCodes(arr){
  try{
    return arr.map(c => String.fromCharCode(c)).join('');
  } catch(e){ return '[DECODE ERROR]'; }
}

/* decode helper used across code */
function decodeSecret(key){
  if(!SECRETS[key]) return '[UNKNOWN]';
  return fromCodes(SECRETS[key]);
}

/* small write helpers */
function write(text, cls){
  const d = document.createElement('div');
  d.className = 'line' + (cls ? ' ' + cls : '');
  d.textContent = text;
  display.appendChild(d);
  display.scrollTop = display.scrollHeight;
  return d;
}
function writeHTML(node){ display.appendChild(node); display.scrollTop = display.scrollHeight; return node; }
function delay(ms){ return new Promise(r => setTimeout(r, ms)); }
async function typeLine(text, speed=8, cls){
  const container = document.createElement('div');
  container.className = 'line' + (cls ? ' ' + cls : '');
  const span = document.createElement('span');
  container.appendChild(span);
  writeHTML(container);
  for(let i=0;i<text.length;i++){
    span.textContent += text[i];
    if(Math.random() < 0.03) { if(Math.random() < 0.4) beep(600 + Math.random()*400, 0.02, 'square', 0.015); }
    display.scrollTop = display.scrollHeight;
    await delay(speed + Math.random()*speed);
  }
}

/* audio elements (user must upload these files alongside index.html) */
let bgAudio = null, ohGodAudio = null;
function initBgAudio(){
  if(bgAudio) return;
  bgAudio = document.createElement('audio');
  bgAudio.src = './background.mp3';
  bgAudio.loop = true;
  bgAudio.volume = 0.16;
  bgAudio.preload = 'auto';
  document.body.appendChild(bgAudio);
}
function initOhGodAudio(){
  if(ohGodAudio) return;
  ohGodAudio = document.createElement('audio');
  ohGodAudio.src = './OhGod.mp3';
  ohGodAudio.preload = 'auto';
  ohGodAudio.controls = true;
  ohGodAudio.style.display = 'none';
  document.body.appendChild(ohGodAudio);
}
function safePlay(a){ try{ if(a) { const p = a.play(); if(p && p.catch) p.catch(()=>{}); } }catch(e){} }

/* state flags */
let receivedPrinted = false;
let hasAccess = false;
let tracedC = false;
let connectedC = false;
let videoRevealed = false;

/* ---------- boot sequence ---------- */
async function boot(){
  initBgAudio();
  flickerLoop(); // start visual flicker loop in background
  await typeLine('BOOT: S.S.O. SECURE ACCESS PANEL INITIALIZING...\\n', 10);
  await loadingBlock('Loading secure transit modules (sector 07)', 1200);
  await loadingBlock('Verifying integrity of sector data', 1000);
  await loadingBlock('Decrypting mission parameters', 900);
  await loadingBlock('Initializing security protocols', 900);
  await loadingBlock('Calibrating terminal sensors', 900);
  await typeLine('AUTH MODULE: ONLINE\\n', 10);
  await delay(200);
  await typeLine('ENTER PASSWORD TO PROCEED:\\n\\n', 12);
  await showPasswordPrompt();
}

/* loading bar visual */
async function loadingBlock(label, dur=900){
  const wrap = document.createElement('div'); wrap.className = 'loading-wrp';
  const lbl = document.createElement('div'); lbl.className = 'loading-label muted'; lbl.textContent = label;
  const track = document.createElement('div'); track.className = 'loading-track';
  const bar = document.createElement('div'); bar.className = 'loading-bar';
  const pct = document.createElement('span'); pct.className = 'loading-percent muted'; pct.textContent = '0%';
  track.appendChild(bar); wrap.appendChild(lbl); wrap.appendChild(track); wrap.appendChild(pct);
  writeHTML(wrap);
  const steps = Math.max(18, Math.floor(dur / 40));
  for(let i=1;i<=steps;i++){
    const p = Math.floor((i/steps) * 100);
    bar.style.width = p + '%'; pct.textContent = p + '%';
    if(Math.random() < 0.4) beep(420 + p*2, 0.02, 'sine', 0.01 + p/2000);
    await delay(Math.floor(dur/steps) + Math.random()*20);
  }
  bar.style.width = '100%'; pct.textContent = '100%';
  beep(900, 0.07, 'sine', 0.06);
  write('] DONE', 'small');
  await delay(80);
}

/* password prompt */
async function showPasswordPrompt(){
  const line = document.createElement('div'); line.className = 'line';
  const prompt = document.createElement('span'); prompt.className = 'prompt'; prompt.textContent = 'PASSWORD> ';
  const input = document.createElement('input'); input.className = 'input'; input.type = 'password'; input.autocomplete='off'; input.spellcheck=false;
  input.style.width = '44%';
  const cursor = document.createElement('span'); cursor.className = 'cursor';
  line.appendChild(prompt); line.appendChild(input); line.appendChild(cursor);
  writeHTML(line);
  focusLastInput();
  input.addEventListener('keydown', async (e) => {
    if(e.key === 'Enter'){
      input.disabled = true; cursor.remove();
      if(!receivedPrinted){ write('RECEIVED', 'muted'); receivedPrinted = true; }
      beep(720,0.06,'square',0.06);
      await delay(140);
      const val = input.value || '';
      if(bgAudio && bgAudio.paused){ safePlay(bgAudio); }
      if(val === PASSWORD){
        // decryption animation then shell
        await runDecryptAnim();
        hasAccess = true;
        write('\\nACCESS GRANTED\\n', 'accent');
        await delay(220);
        startShell();
      } else {
        write('\\nACCESS DENIED\\n', 'err');
        noiseBurst(0.12,0.05);
        await delay(260);
        showPasswordPrompt();
      }
    } else {
      if(Math.random() < 0.18) beep(600 + Math.random()*160, 0.02, 'square', 0.01);
    }
  });
}

/* small decrypt animation */
async function runDecryptAnim(){
  write('\\nDECRYPTING: ACCESS KEYS\\n', 'muted');
  for(let i=0;i<5;i++){
    const l = 'KEYCHAIN SEGMENT ' + (100+i) + ' : ' + Math.random().toString(36).slice(2,18);
    await typeLine(l, 5, 'small');
    await delay(120);
  }
  await loadingBlock('Applying local decryption token', 900);
  write('\\nDECRYPTION COMPLETE.\\n', 'small');
  await delay(120);
  if(bgAudio) safePlay(bgAudio);
}

/* shell */
function startShell(){ write('Welcome to S.S.O. LOCAL SHELL. Type HELP for commands.\\n', 'accent'); showCommandPrompt(); }
function showCommandPrompt(){
  const line = document.createElement('div'); line.className = 'line cmdline';
  const prompt = document.createElement('span'); prompt.className = 'prompt'; prompt.textContent = 'S.S.O.# ';
  const input = document.createElement('input'); input.className = 'input'; input.type = 'text'; input.autocomplete='off'; input.spellcheck=false;
  input.style.width = '72%';
  const cursor = document.createElement('span'); cursor.className = 'cursor';
  line.appendChild(prompt); line.appendChild(input); line.appendChild(cursor);
  writeHTML(line);
  focusLastInput();
  input.addEventListener('keydown', async (e) => {
    if(e.key === 'Enter'){
      input.disabled = true; cursor.remove();
      const raw = input.value.trim();
      const cmd = raw.toUpperCase();
      if(Math.random() < 0.6) beep(540,0.04,'sine',0.02);
      await handleCommand(cmd, raw);
    } else {
      if(Math.random() < 0.12) beep(660,0.02,'square',0.01);
    }
  });
}

/* ---------- command handler (sequential logic) ---------- */
async function handleCommand(cmd, raw){
  if(!cmd){ showCommandPrompt(); return; }

  // HELP: intentionally hide lore-heavy commands to avoid revealing sequence
  if(cmd === 'HELP' || cmd === '?'){
    write('\\nAVAILABLE COMMANDS:', 'muted');
    write('  HELP                 - Show this help');
    write('  ACCESS FILE://S7OPR   - Open classified access file (alias: LOG#1)');
    write('  TRACE                - Run radar trace');
    write('  CONNECT              - Attempt network handshake (requires TRACE GROUP C)');
    write('  WHOAMI               - Terminal identity');
    write('  ASCII                - Show static');
    write('  CLEAR                - Clear screen');
    write('  REBOOT               - Reboot terminal');
    write('  EXIT                 - Logout\\n');
    showCommandPrompt(); return;
  }

  // CLEAR
  if(cmd === 'CLEAR'){
    display.innerHTML = '';
    const st = document.createElement('div'); st.className='status small'; st.textContent='S.S.O. SYSTEM — SECTOR 07 ACCESS PANEL';
    display.parentNode.insertBefore(st, display);
    write('\\n> SCREEN CLEARED\\n', 'muted');
    showCommandPrompt(); return;
  }

  // EXIT
  if(cmd === 'EXIT'){
    write('\\n> SESSION TERMINATED.\\n', 'muted');
    beep(320,0.06,'sine',0.04);
    await delay(200);
    location.reload();
    return;
  }

  // ACCESS FILE://S7OPR (LOG#1 alias)
  if(cmd === 'ACCESS FILE://S7OPR' || cmd === 'LOG#1'){
    // display the AUTHORIZED block
    await revealSecret('AUTHORIZED');
    showCommandPrompt(); return;
  }

  // TRACE
  if(cmd === 'TRACE'){
    await runAsciiRadar();
    const append = decodeSecret('TRACE_APPEND');
    write('\\n' + append, 'muted');
    write('\\nType \"TRACE GROUP C\" to attempt follow-up trace if instructed.', 'small');
    showCommandPrompt(); return;
  }

  // TRACE GROUP C
  if(cmd === 'TRACE GROUP C' || cmd === 'TRACE GROUPC'){
    const t = decodeSecret('TRACE_GROUP_C');
    write('\\n' + t, 'muted');
    tracedC = true;
    showCommandPrompt(); return;
  }

  // CONNECT
  if(cmd === 'CONNECT'){
    write('\\nNETWORK HANDSHAKE: START', 'muted');
    await loadingBlock('Establishing secure channel', 900);
    const chance = tracedC ? 0.95 : 0.25;
    if(Math.random() < chance){
      write('\\n' + decodeSecret('CONNECT_SUCCESS'), 'accent');
      connectedC = true;
      initOhGodAudio();
      // clickable play link (required for most browsers)
      const info = document.createElement('div'); info.className='line small';
      info.innerHTML = 'CONNECTION SUCCESS. CLICK TO PLAY REMOTE AUDIO: <a id="playMike" href="#" style="color:#62d662">PLAY MIKE AUDIO</a>';
      writeHTML(info);
      const link = document.getElementById('playMike');
      link.addEventListener('click', (e) => { e.preventDefault(); if(ohGodAudio){ ohGodAudio.style.display='block'; ohGodAudio.play().catch(()=>{}); }});
    } else {
      write('\\nHANDSHAKE: FAILED (TIMEOUT)', 'err');
      noiseBurst(0.12,0.05);
    }
    showCommandPrompt(); return;
  }

  // OHGOD (must be connected)
  if(cmd === 'OHGOD'){
    if(!connectedC){ write('\\nERROR: NO ACTIVE CONNECTION TO REMOTE SOURCE', 'err'); showCommandPrompt(); return; }
    const t = decodeSecret('OHGOD');
    const pre = document.createElement('pre'); pre.className='box'; pre.textContent = t;
    writeHTML(pre);
    initOhGodAudio();
    if(ohGodAudio){ ohGodAudio.style.display = 'block'; write('CLICK PLAY TO HEAR THE RECORDING', 'small'); }
    showCommandPrompt(); return;
  }

  // FALLEN (reveals encrypted link / triggers next stage)
  if(cmd === 'FALLEN'){
    if(!connectedC){ write('\\nERROR: REMOTE SOURCE NOT CONNECTED', 'err'); showCommandPrompt(); return; }
    const t = decodeSecret('FALLEN');
    write('\\n' + t, 'muted');
    videoRevealed = true;
    write('\\n(.....)', 'small');
    showCommandPrompt(); return;
  }

  // NOTHINGISASITSHOULDBE (only after video)
  if(cmd === 'NOTHINGISASITSHOULDBE'){
    if(!videoRevealed){ write('\\nERROR: VIDEO NOT REVEALED', 'err'); showCommandPrompt(); return; }
    const t = decodeSecret('AUDIO_TRANSCRIPT');
    const pre = document.createElement('pre'); pre.className='box'; pre.textContent = t;
    writeHTML(pre);
    showCommandPrompt(); return;
  }

  // THEYREKEEPINGONEALIVE
  if(cmd === 'THEYREKEEPINGONEALIVE'){
    const t = decodeSecret('THEYREKEEP');
    const pre = document.createElement('pre'); pre.className='box'; pre.textContent = t;
    writeHTML(pre);
    showCommandPrompt(); return;
  }

  // ACCESS://FILE:FENIX
  if(cmd === 'ACCESS FILE://FENIX'){
    const t = decodeSecret('ACCESS_FENIX');
    const pre = document.createElement('pre'); pre.className='box'; pre.textContent = t;
    writeHTML(pre);
    showCommandPrompt(); return;
  }

  // G13-02 (end sequence)
  if(cmd === 'G13-02' || cmd === 'G13'){
    const t = decodeSecret('G13');
    const pre = document.createElement('pre'); pre.className='box'; pre.textContent = t;
    writeHTML(pre);
    await delay(300);
    write('\\n<< ERROR TERMINAL HAS BEEN HIJACKED PLEASE', 'err');
    write('<< I KNOW WHO YOU ARE.', 'err');
    write('<< YOU WANT TOO MUCH.', 'err');
    write('<< THEY KILLED A TON OF INNOCENT PEOPLE.', 'err');
    write('<< THEY TESTED ON INNOCENT PEOPLE.', 'err');
    write('<< THEY ALL DIED IN HORRIFYING WAYS.', 'err');
    write('<< ITS ALL HIS FAULT.', 'err');
    await delay(800);
    await endSequence();
    return;
  }

  // WHOAMI
  if(cmd === 'WHOAMI'){ write('\\nS.S.O. COMMAND NODE: SECTOR-07 ACCESS PANEL', 'muted'); showCommandPrompt(); return; }

  // ASCII / DECRYPT / REBOOT
  if(cmd === 'ASCII'){ await showAsciiStatic(); showCommandPrompt(); return; }
  if(cmd === 'DECRYPT'){ await doDecrypt(); showCommandPrompt(); return; }
  if(cmd === 'REBOOT'){ await doReboot(); return; }

  // unknown
  write('\\nSYSTEM ERROR: UNKNOWN COMMAND ' + cmd, 'err');
  noiseBurst(0.08,0.035);
  if(Math.random() < 0.35){ await delay(120); write('ECHO: ' + corruptText(cmd), 'muted'); }
  showCommandPrompt();
}

/* reveal secret helper (typewriter) */
async function revealSecret(key){
  if(!SECRETS[key]){ write('\\n[UNKNOWN SECRET]', 'err'); return; }
  const txt = decodeSecret(key);
  const lines = txt.split('\\n');
  for(let ln of lines){
    if(ln.trim() === ''){ write(''); await delay(40); continue; }
    await typeLine(ln + '\\n', 8);
  }
}

/* radar ascii */
async function runAsciiRadar(){
  write('\\nRADAR TRACE: INITIALIZING\\n', 'muted');
  const rows = 12;
  for(let r=0;r<rows;r++){
    let line = '';
    for(let c=0;c<72;c++){
      if(Math.random() < Math.max(0.02, 0.01 + r*0.002)) line += (Math.random() < 0.02 ? '*' : '.');
      else line += ' ';
    }
    write(line, 'ascii');
    if(r % 3 === 0) beep(420 + r*20, 0.02, 'sine', 0.02);
    await delay(60);
  }
  write('\\nTRACE COMPLETE: NO CONSPICUOUS SIGNATURES', 'muted');
  beep(820, 0.06, 'sine', 0.04);
}

/* ascii static */
async function showAsciiStatic(){
  for(let r=0;r<18;r++){
    let line = '';
    for(let c=0;c<96;c++){
      if(Math.random() < 0.035) line += String.fromCharCode(33 + Math.floor(Math.random() * 94));
      else line += ' ';
    }
    write(line, 'ascii muted');
    if(r % 4 === 0) noiseBurst(0.03,0.01);
    await delay(24);
  }
}

/* decrypt routine */
async function doDecrypt(){
  write('\\nDECRYPTION: INITIATING', 'muted');
  for(let i=0;i<18;i++){
    write(generateHexLine(64), 'small');
    if(i % 4 === 0) beep(720 + i*6, 0.02, 'square', 0.02);
    await delay(50);
  }
  write('\\nDECRYPTION COMPLETE: CONTENT REDACTED OR CORRUPTED', 'warn');
}

/* small utilities */
function generateHexLine(len){ const hex='0123456789ABCDEF'; let s=''; for(let i=0;i<len;i++) s += hex[Math.floor(Math.random()*hex.length)]; return s; }
function corruptText(s){ const glyphs=['@','%','¥','ƒ','∑','■','▒','▓','█','Δ','Ж','?','*']; return s.split('').map(ch => (Math.random() < 0.3 ? glyphs[Math.floor(Math.random()*glyphs.length)] : ch)).join(''); }

/* reboot */
async function doReboot(){
  write('\\nREBOOTING SYSTEM...', 'muted'); beep(330,0.06,'sine',0.05);
  await delay(420);
  // reset state
  display.innerHTML = '';
  const st = document.createElement('div'); st.className='status small'; st.textContent = 'S.S.O. SYSTEM — SECTOR 07 ACCESS PANEL';
  display.parentNode.insertBefore(st, display);
  receivedPrinted = false; hasAccess = false; tracedC = false; connectedC = false; videoRevealed = false;
  await delay(120);
  await boot();
}

/* flicker + jitter */
async function flickerLoop(){
  const frame = document.querySelector('.frame');
  while(true){
    frame.classList.add('flicker');
    if(Math.random() < 0.25) noiseBurst(0.045, 0.025);
    await delay(90 + Math.random()*130);
    frame.classList.remove('flicker');
    if(Math.random() < 0.18){
      const displayEl = document.querySelector('.display');
      displayEl.style.transform = `translate(${(Math.random()-0.5)*1.6}px, ${(Math.random()-0.5)*1.6}px)`;
      await delay(60 + Math.random()*80);
      displayEl.style.transform = '';
    }
    await delay(1800 + Math.random()*2200);
  }
}

/* end-of-act cinematic sequence:
   - fade out bg audio
   - show end.png inside terminal
   - wait, then heavy beeps + auto-typing jump-scare
   - reboot
*/
async function endSequence(){
  // fade out background music
  try{
    if(bgAudio){
      let vol = bgAudio.volume;
      for(let i=0;i<10;i++){ vol = Math.max(0, vol - 0.08); bgAudio.volume = vol; await delay(120); }
      bgAudio.pause();
    }
  }catch(e){}

  // show image (end.png)
  const img = document.createElement('img');
  img.src = './end.png';
  img.style.maxWidth = '96%';
  img.style.maxHeight = '86%';
  img.style.display = 'block';
  img.style.margin = '12px auto';
  const cont = document.createElement('div'); cont.className = 'line'; cont.appendChild(img);
  writeHTML(cont);

  // pause slightly, then jumpscare: heavy beeps + auto-typing
  await delay(1800);
  const start = Date.now();
  const duration = 2200;
  while(Date.now() - start < duration){
    beep(1200 + Math.random()*800, 0.03, 'square', 0.12);
    const a = document.createElement('div'); a.className = 'line err';
    a.textContent = corruptText('AUTOTYPE: ' + Math.random().toString(36).slice(2,12));
    display.appendChild(a);
    display.scrollTop = display.scrollHeight;
    await delay(80 + Math.random()*60);
  }

  // final corruption lines
  for(let i=0;i<6;i++){ write('<<< CORE MEMORY DUMPING ::: SECTOR STREAM CORRUPTION >>>', 'err'); noiseBurst(0.08 + Math.random()*0.08, 0.06); await delay(90 + Math.random()*100); }

  // small delay then reboot
  await delay(400);
  await doReboot();
}

/* focus helper */
function focusLastInput(){ setTimeout(()=>{ const inputs = display.querySelectorAll('input'); if(inputs.length) inputs[inputs.length-1].focus(); display.scrollTop = display.scrollHeight; }, 8); }

/* resume audio on first click (browsers require user gesture) */
document.addEventListener('click', function resume(){
  if(audioCtx && audioCtx.state === 'suspended') audioCtx.resume();
  if(bgAudio && bgAudio.paused){ try{ bgAudio.play().catch(()=>{}); }catch(e){} }
  document.removeEventListener('click', resume);
});

/* init */
(async function init(){
  initBgAudio();
  await boot();
})();

</script>
</body>

</html>
